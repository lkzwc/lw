{"version":3,"file":"publish.js","sources":["pages/community/publish.vue","pages/community/publish.vue?type=page"],"sourcesContent":["<template>\n\t<view class=\"container\">\n\t\t<form @submit=\"submitPost\">\n\t\t\t<!-- 帖子标题 -->\n\t\t\t<view class=\"form-group\">\n\t\t\t\t<text class=\"label\">帖子标题 *</text>\n\t\t\t\t<input \n\t\t\t\t\tclass=\"input\" \n\t\t\t\t\tv-model=\"postData.title\" \n\t\t\t\t\tplaceholder=\"请输入帖子标题\"\n\t\t\t\t\tmaxlength=\"100\"\n\t\t\t\t/>\n\t\t\t</view>\n\n\t\t\t<!-- 帖子内容 -->\n\t\t\t<view class=\"form-group\">\n\t\t\t\t<text class=\"label\">帖子内容 *</text>\n\t\t\t\t<textarea \n\t\t\t\t\tclass=\"textarea\" \n\t\t\t\t\tv-model=\"postData.content\" \n\t\t\t\t\tplaceholder=\"分享你的想法、经验或问题...\"\n\t\t\t\t\tmaxlength=\"2000\"\n\t\t\t\t></textarea>\n\t\t\t</view>\n\n\t\t\t<!-- 帖子图片 -->\n\t\t\t<view class=\"form-group\">\n\t\t\t\t<text class=\"label\">添加图片</text>\n\t\t\t\t<ImageUploader \n\t\t\t\t\tv-model=\"postData.images\"\n\t\t\t\t\t:max-count=\"9\"\n\t\t\t\t\tmodule=\"community\"\n\t\t\t\t\t@upload-success=\"onUploadSuccess\"\n\t\t\t\t\t@upload-error=\"onUploadError\"\n\t\t\t\t/>\n\t\t\t</view>\n\n\t\t\t<!-- 帖子分类 -->\n\t\t\t<view class=\"form-group\">\n\t\t\t\t<text class=\"label\">帖子分类</text>\n\t\t\t\t<picker \n\t\t\t\t\t:value=\"categoryIndex\" \n\t\t\t\t\t:range=\"categories\" \n\t\t\t\t\trange-key=\"name\"\n\t\t\t\t\t@change=\"onCategoryChange\"\n\t\t\t\t>\n\t\t\t\t\t<view class=\"picker\">\n\t\t\t\t\t\t{{ postData.category || '请选择帖子分类' }}\n\t\t\t\t\t</view>\n\t\t\t\t</picker>\n\t\t\t</view>\n\n\t\t\t<!-- 提交按钮 -->\n\t\t\t<button \n\t\t\t\tclass=\"submit-btn\" \n\t\t\t\t:disabled=\"isSubmitting\"\n\t\t\t\t@tap=\"submitPost\"\n\t\t\t>\n\t\t\t\t{{ isSubmitting ? '发布中...' : '发布帖子' }}\n\t\t\t</button>\n\t\t</form>\n\t</view>\n</template>\n\n<script setup>\n\timport { ref, reactive } from 'vue';\n\timport { onLoad } from '@dcloudio/uni-app';\n\timport ImageUploader from '@/components/ImageUploader.vue';\n\n\t// 响应式数据\n\tconst postData = reactive({\n\t\ttitle: '',\n\t\tcontent: '',\n\t\timages: [],\n\t\tcategory: '闲聊交流'\n\t});\n\n\tconst isSubmitting = ref(false);\n\tconst categoryIndex = ref(0);\n\n\t// 帖子分类\n\tconst categories = ref([\n\t\t{ name: '闲聊交流', value: 'chat' },\n\t\t{ name: '技能分享', value: 'skill' },\n\t\t{ name: '求助问答', value: 'help' },\n\t\t{ name: '经验分享', value: 'experience' },\n\t\t{ name: '资源分享', value: 'resource' },\n\t\t{ name: '其他', value: 'other' }\n\t]);\n\n\t// 云对象实例\n\tlet communityObj = null;\n\n\t// 初始化云对象\n\tconst initCloudObj = () => {\n\t\ttry {\n\t\t\tcommunityObj = uniCloud.importObject('community');\n\t\t} catch (error) {\n\t\t\tuni.showToast({\n\t\t\t\ttitle: '服务初始化失败',\n\t\t\t\ticon: 'none'\n\t\t\t});\n\t\t}\n\t};\n\n\t// 分类选择\n\tconst onCategoryChange = (e) => {\n\t\tcategoryIndex.value = e.detail.value;\n\t\tpostData.category = categories.value[e.detail.value].name;\n\t};\n\n\t// 图片上传成功回调\n\tconst onUploadSuccess = (data) => {\n\t\t// 图片上传成功，ImageUploader组件会自动更新postData.images\n\t};\n\n\t// 图片上传失败回调\n\tconst onUploadError = (error) => {\n\t\t// 图片上传失败处理\n\t};\n\n\t// 表单验证\n\tconst validateForm = () => {\n\t\tif (!postData.title.trim()) {\n\t\t\tuni.showToast({\n\t\t\t\ttitle: '请输入帖子标题',\n\t\t\t\ticon: 'none'\n\t\t\t});\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!postData.content.trim()) {\n\t\t\tuni.showToast({\n\t\t\t\ttitle: '请输入帖子内容',\n\t\t\t\ticon: 'none'\n\t\t\t});\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t};\n\n\t// 提交帖子\n\tconst submitPost = async () => {\n\t\tif (!validateForm()) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (isSubmitting.value) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!communityObj) {\n\t\t\tinitCloudObj();\n\t\t\tif (!communityObj) {\n\t\t\t\tuni.showToast({\n\t\t\t\t\ttitle: '服务不可用，请重试',\n\t\t\t\t\ticon: 'none'\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\ttry {\n\t\t\tisSubmitting.value = true;\n\n\t\t\t// 准备提交数据\n\t\t\tconst submitData = {\n\t\t\t\ttitle: postData.title.trim(),\n\t\t\t\tcontent: postData.content.trim(),\n\t\t\t\timages: postData.images,\n\t\t\t\tcategory: postData.category\n\t\t\t};\n\n\t\t\t// 调用云对象提交帖子\n\t\t\tconst result = await communityObj.addPost(submitData);\n\n\t\t\tif (result.errCode === 0) {\n\t\t\t\tuni.showToast({\n\t\t\t\t\ttitle: '帖子发布成功',\n\t\t\t\t\ticon: 'success'\n\t\t\t\t});\n\n\t\t\t\t// 返回社区页面\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tuni.navigateBack();\n\t\t\t\t}, 1500);\n\t\t\t} else {\n\t\t\t\tuni.showToast({\n\t\t\t\t\ttitle: result.errMsg || '发布失败',\n\t\t\t\t\ticon: 'none'\n\t\t\t\t});\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tuni.showToast({\n\t\t\t\ttitle: '网络错误，请重试',\n\t\t\t\ticon: 'none'\n\t\t\t});\n\t\t} finally {\n\t\t\tisSubmitting.value = false;\n\t\t}\n\t};\n\n\tonLoad(() => {\n\t\tinitCloudObj();\n\t});\n</script>\n\n<style scoped>\n\t.container {\n\t\tpadding: 30rpx;\n\t\tbackground: #f8f9fa;\n\t\tmin-height: 100vh;\n\t}\n\n\t.form-group {\n\t\tbackground: white;\n\t\tborder-radius: 16rpx;\n\t\tpadding: 30rpx;\n\t\tmargin-bottom: 20rpx;\n\t\tbox-shadow: 0 2rpx 12rpx rgba(0, 0, 0, 0.06);\n\t}\n\n\t.label {\n\t\tdisplay: block;\n\t\tfont-size: 28rpx;\n\t\tfont-weight: bold;\n\t\tcolor: #333;\n\t\tmargin-bottom: 20rpx;\n\t}\n\n\t.input, .textarea, .picker {\n\t\twidth: 100%;\n\t\tpadding: 20rpx;\n\t\tborder: 1rpx solid #e5e5e5;\n\t\tborder-radius: 12rpx;\n\t\tfont-size: 28rpx;\n\t\tcolor: #333;\n\t\tbackground: #fafafa;\n\t}\n\n\t.textarea {\n\t\theight: 300rpx;\n\t\tresize: none;\n\t}\n\n\t.picker {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\theight: 80rpx;\n\t\tcolor: #666;\n\t}\n\n\t.submit-btn {\n\t\twidth: 100%;\n\t\theight: 88rpx;\n\t\tbackground: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n\t\tcolor: white;\n\t\tborder: none;\n\t\tborder-radius: 16rpx;\n\t\tfont-size: 32rpx;\n\t\tfont-weight: bold;\n\t\tmargin-top: 40rpx;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t}\n\n\t.submit-btn:disabled {\n\t\topacity: 0.6;\n\t}\n\n\t.submit-btn:active:not(:disabled) {\n\t\ttransform: scale(0.98);\n\t}\n</style>","import MiniProgramPage from '/Users/zwc/Documents/HBuilderProjects/hxzyL/pages/community/publish.vue'\nwx.createPage(MiniProgramPage)"],"names":["reactive","ref","uniCloud","uni","onLoad"],"mappings":"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"}